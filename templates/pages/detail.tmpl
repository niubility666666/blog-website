<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{block "title" .}} - æŠ€æœ¯ç¤¾åŒº{{end}}</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
  <link rel="stylesheet" href="/static/css/app.css">
</head>
<body class="dark-theme">
{{template "header" .}}

<main>
<div class="container">
  <div class="main-content">
    <div class="content">
      <!-- å¸–å­å†…å®¹ -->
      <div class="card post-content">
        <div class="post-header">
          <h1 class="post-title">{{.Post.Title}}</h1>
          <div class="post-meta">
            <div class="author-info">
              <img src="{{.User.Avatar}}" alt="ç”¨æˆ·å¤´åƒ" class="avatar avatar-default">
              <div class="author-details">
                <span class="author-name">{{.User.Name}}</span>
                <span class="post-time">å‘å¸ƒäº {{timeAgo .Post.CreatedAt}}</span>
              </div>
            </div>
            <div class="post-stats">
              <span class="stat-item">æµè§ˆ {{.Post.Views}}</span>
              <span class="stat-item">å›å¤ {{.Post.Replies}}</span>
              <span class="stat-item">æ”¶è— {{.Post.Favorites}}</span>
            </div>
          </div>
          <div class="post-tags">
            {{range .Tags}}
            <a href="#" class="node-tag">{{.}}</a>
            {{end}}
          </div>
        </div>

        <div class="post-body">
          {{.Content}}
        </div>

        <div class="post-actions">
          <button class="action-btn like-btn">
            <span class="icon">ğŸ‘</span>
            <span>{{.Post.Likes}}</span>
          </button>
          <button class="action-btn favorite-btn">
            <span class="icon">â­</span>
            {{if .Post.Favorites}}
            <span>å·²æ”¶è—</span>
            {{else}}
            <span>æ”¶è—</span>
            {{end}}
          </button>
          <button class="action-btn share-btn">
            <span class="icon">â†—ï¸</span>
            <span>åˆ†äº«</span>
          </button>
        </div>
      </div>

      <!-- è¯„è®ºåŒº -->
      <div class="card comments-section">
        <div class="card-header">
          <div class="card-title">è¯„è®º ({{.commentTotalCount}})</div>
        </div>

        <!-- è¯„è®ºè¡¨å• -->
        <div class="comment-form" data-post-id="{{.Post.ID}}">
          <textarea placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." rows="4"></textarea>
          <input type="hidden" id="parent-id" name="parent_id" value="0">
          <div class="comment-actions">
            <button class="btn btn-primary">å‘è¡¨è¯„è®º</button>
          </div>
        </div>

        <!-- è¯„è®ºåˆ—è¡¨ -->
        <div class="comment-list">
          {{$currentUserID := 0}}
          {{if .user}}
          {{$currentUserID = .user.ID}}
          {{end}}
          {{range .Comments}}
          <div class="comment-item" data-comment-id="{{.ID}}" data-user-id="{{.User.ID}}" data-current-user-id="{{$currentUserID}}">
            <div class="comment-header">
              <img src="{{.User.Avatar}}" alt="ç”¨æˆ·å¤´åƒ" class="avatar small">
              <div class="comment-author">{{.User.Name}}</div>
              <div class="comment-time">{{.TimeAgo}}</div>
            </div>
            <div class="comment-content">
              <p>{{.Content}}</p>
            </div>
            <div class="comment-actions">
              <button class="reply-btn">å›å¤</button>
              <button class="like-btn" data-comment-id="{{.ID}}" data-action="like">ğŸ‘ {{.LikeCount}}</button>
            </div>

            {{if .Replies}}
            <!-- å­è¯„è®º -->
            <div class="comment-reply">
              {{range .Replies}}
              <div class="comment-item" data-comment-id="{{.ID}}" data-user-id="{{.User.ID}}" data-current-user-id="{{$currentUserID}}">
                <div class="comment-header">
                  <img src="{{.User.Avatar}}" alt="ç”¨æˆ·å¤´åƒ" class="avatar small">
                  <div class="comment-author">{{.User.Name}}</div>
                  <div class="comment-time">{{.TimeAgo}}</div>
                </div>
                <div class="comment-content">
                  <p>{{.Content}}</p>
                </div>
                <div class="comment-actions">
                  <button class="reply-btn">å›å¤</button>
                  <button class="like-btn" data-comment-id="{{.ID}}" data-action="like">ğŸ‘ {{.LikeCount}}</button>
                </div>
              </div>
              {{end}}
            </div>
            {{end}}
          </div>
          {{else}}
          <p>æš‚æ— è¯„è®º</p>
          {{end}}

          <!-- åœ¨è¯„è®ºåˆ—è¡¨å¾ªç¯å¤–éƒ¨ä½¿ç”¨é¡µé¢å˜é‡ -->
          {{if gt .commentTotalPages 1}}
          <div class="pagination1">
            <div class="pagination-pages">
              {{$commentCurrentPage := .commentCurrentPage}}
              {{$commentTotalPages := .commentTotalPages}}

              {{if gt $commentCurrentPage 5}}
              <a href="?page=1" class="page-link">1</a>
              {{if gt $commentCurrentPage 6}}<span class="page-ellipsis">...</span>{{end}}
              {{end}}

              {{$commentStart := sub $commentCurrentPage 4}}
              {{$commentEnd := add $commentCurrentPage 4}}

              {{if le $commentStart 0}}{{$commentStart = 1}}{{end}}
              {{if gt $commentEnd $commentTotalPages}}{{$commentEnd = $commentTotalPages}}{{end}}

              {{range loop $commentStart $commentEnd}}
              {{if eq . $commentCurrentPage}}
              <a class="page-link active">{{.}}</a>
              {{else}}
              <a href="?page={{.}}" class="page-link">{{.}}</a>
              {{end}}
              {{end}}

              {{if lt $commentCurrentPage (sub $commentTotalPages 4)}}
              {{if lt $commentCurrentPage (sub $commentTotalPages 5)}}<span class="page-ellipsis">...</span>{{end}}
              <a href="?page={{$commentTotalPages}}" class="page-link">{{$commentTotalPages}}</a>
              {{end}}
            </div>

            <div class="pagination-nav">
              {{if .commentHasPrev}}
              <a href="?page={{.commentPrevPage}}" class="page-link">â€¹ ä¸Šä¸€é¡µ</a>
              {{else}}
              <a class="page-link disabled">â€¹ ä¸Šä¸€é¡µ</a>
              {{end}}

              {{if .commentHasNext}}
              <a href="?page={{.commentNextPage}}" class="page-link">ä¸‹ä¸€é¡µ â€º</a>
              {{else}}
              <a class="page-link disabled">ä¸‹ä¸€é¡µ â€º</a>
              {{end}}
            </div>
          </div>
          {{end}}


        </div>
      </div>

      <!-- ç›¸å…³å¸–å­ -->
      <div class="card related-posts">
        <div class="card-header">
          <div class="card-title">ç›¸å…³å¸–å­</div>
        </div>
        {{if .RelatedPosts}}
        <div class="post-list">

          {{range .RelatedPosts}}
          <div class="post-item">
            <a href="#" class="post-title">{{ .Title }}</a>
            <div class="post-meta">
              <span>ä½œè€…: {{ .Author }}</span>
              <span>å›å¤: {{ .Replies }}</span>
              <span>å‘å¸ƒäº {{timeAgo .CreatedAt}}</span>
            </div>
          </div>
          {{end}}
        </div>
        {{else}}
        <div>æš‚æ— ç›¸å…³å¸–å­</div>
        {{end}}
      </div>
    </div>

    <div class="sidebar">
      <div class="card author-card">
        <div class="card-header">
          <div class="card-title">ä½œè€…ä¿¡æ¯</div>
        </div>
        <div class="author-info">
          <img src="{{.User.Avatar}}" alt="{{.User.Name}}" class="avatar large">
          <div class="author-details">
            <div class="author-name">{{.User.Name}}</div>
            <div class="author-bio">{{.User.Motto}}</div>
          </div>
        </div>
        <div class="author-stats">
          <a class="stat" href="/posts">
            <div class="stat-number">{{.postCount}}</div>
            <div class="stat-label">å¸–å­</div>
          </a>
          <div class="stat">
            <div class="stat-number">{{.replyCount}}</div>
            <div class="stat-label">å›å¤</div>
          </div>
          <div class="stat">
            <div class="stat-number">{{.likeCount}}</div>
            <div class="stat-label">è·èµ</div>
          </div>
        </div>
        {{if .user}}
        <div class="quick-post">
          <a href="/publish" class="btn btn-primary">å‘è¡¨æ–°æ–‡ç« </a>
        </div>
        {{end}}
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">çƒ­é—¨æ ‡ç­¾</div>
        </div>
        <div class="node-list">
          <a href="#" class="node-tag">VPS</a>
          <a href="#" class="node-tag">Linux</a>
          <a href="#" class="node-tag">Docker</a>
          <a href="#" class="node-tag">Node.js</a>
          <a href="#" class="node-tag">Python</a>
          <a href="#" class="node-tag">æ•°æ®åº“</a>
          <a href="#" class="node-tag">CDN</a>
          <a href="#" class="node-tag">ç½‘ç»œå®‰å…¨</a>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">å…¬å‘Š</div>
        </div>
        <div class="announcement">
          <p>ç¤¾åŒºæ–°åŠŸèƒ½ï¼šç°åœ¨æ”¯æŒä»£ç é«˜äº®å’Œæ•°å­¦å…¬å¼æ˜¾ç¤ºäº†ï¼</p>
          <p>æ¬¢è¿å‚ä¸æˆ‘ä»¬çš„å¼€æºé¡¹ç›®ï¼Œå…±åŒå®Œå–„Doniaiç¤¾åŒºã€‚</p>
        </div>
      </div>
    </div>
  </div>
</div>
</main>

{{template "footer" .}}

<script src="/static/js/app.js"></script>
<script src="/static/js/comment.js"></script>
</body>
</html>